<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <title>Modifying or Deleting a Line from an Old Commit | concise notes</title> <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"> <meta name="description" content="I’ll spare you and assume you know what you’re doing, so here’s the short version. Keep reading for a more comprehensive one.  Find the commit you want to change or delete Get the SHA of its child com"> <meta property="og:type" content="article"> <meta property="og:title" content="Modifying or Deleting a Line from an Old Commit"> <meta property="og:url" content="https://vhf.github.io/blog/2016/01/20/modifying-or-deleting-a-line-from-an-old-commit/index.html"> <meta property="og:site_name" content="concise notes"> <meta property="og:description" content="I’ll spare you and assume you know what you’re doing, so here’s the short version. Keep reading for a more comprehensive one.  Find the commit you want to change or delete Get the SHA of its child com"> <meta property="og:updated_time" content="2016-01-21T09:05:02.000Z"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Modifying or Deleting a Line from an Old Commit"> <meta name="twitter:description" content="I’ll spare you and assume you know what you’re doing, so here’s the short version. Keep reading for a more comprehensive one.  Find the commit you want to change or delete Get the SHA of its child com"> <meta name="twitter:creator" content="@_vhf"> <link rel="alternative" href="/blog/atom.xml" title="concise notes" type="application/atom+xml"> <link rel="shortcut icon" href="/favicons/favicon.ico"> <link rel="icon" sizes="16x16 32x32 64x64" href="/favicons/favicon.ico"> <link rel="icon" type="image/png" sizes="196x196" href="/favicons/favicon-192.png"> <link rel="icon" type="image/png" sizes="160x160" href="/favicons/favicon-160.png"> <link rel="icon" type="image/png" sizes="96x96" href="/favicons/favicon-96.png"> <link rel="icon" type="image/png" sizes="64x64" href="/favicons/favicon-64.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16.png"> <link rel="apple-touch-icon" href="/favicons/favicon-57.png"> <link rel="apple-touch-icon" sizes="114x114" href="/favicons/favicon-114.png"> <link rel="apple-touch-icon" sizes="72x72" href="/favicons/favicon-72.png"> <link rel="apple-touch-icon" sizes="144x144" href="/favicons/favicon-144.png"> <link rel="apple-touch-icon" sizes="60x60" href="/favicons/favicon-60.png"> <link rel="apple-touch-icon" sizes="120x120" href="/favicons/favicon-120.png"> <link rel="apple-touch-icon" sizes="76x76" href="/favicons/favicon-76.png"> <link rel="apple-touch-icon" sizes="152x152" href="/favicons/favicon-152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/favicons/favicon-180.png"> <meta name="msapplication-TileColor" content="#FFFFFF"> <meta name="msapplication-TileImage" content="/favicons/favicon-144.png"> <meta name="msapplication-config" content="/favicons/browserconfig.xml"> <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> <link rel="stylesheet" href="/blog/css/style.css" type="text/css"> <script type="text/javascript">!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-69443473-1","auto"),ga("send","pageview");</script></head></html><body> <div class="container"> <div class="page-wrap"> <header class="page-header" role="banner" itemscope itemtype="http://schema.org/WPHeader"> <nav itemscope itemtype="http://schema.org/SiteNavigationElement"> <div class="nav-wrapper"> <h1 class="brand-logo" itemprop="headline"><a href="/blog/" rel="home">concise notes</a></h1> <meta itemprop="description" content="Victor Felder's blog"> <a href="#" id="mobile-menu" class="hide-on-med-and-up"><i class="material-icons">menu</i></a> <nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement"> <ul class="right hide-on-med-and-down"> <li><a class="main-nav-link" href="/blog/">Home</a></li> <li><a class="main-nav-link" href="/blog/archives">Archives</a></li> <li><a class="main-nav-link" href="https://vhf.github.io">About</a></li> <li><a class="rss-icon" href="/blog/atom.xml" title="RSS Feed"></a></li> </ul> </nav> <nav class="side-nav"> <ul id="nav-mobile"> <li><a class="main-nav-link" href="/blog/">Home</a></li> <li><a class="main-nav-link" href="/blog/archives">Archives</a></li> <li><a class="main-nav-link" href="https://vhf.github.io">About</a></li> <li><a id="mobile-menu-close" class="main-nav-link" href="#">Close the menu</a></li> </ul> </nav> </div> </nav> </header> <div class="pattern"></div> <main class="page-main" role="main" tabindex="-1"> <article id="post-modifying-or-deleting-a-line-from-an-old-commit" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting" itemprop="blogPost"> <link itemprop="mainEntityOfPage" href="/blog/2016/01/20/modifying-or-deleting-a-line-from-an-old-commit/"> <nav> <div class="nav-wrapper"> <div class="col s12"> <a href="/blog/2016/01/20/modifying-or-deleting-a-line-from-an-old-commit/" class="breadcrumb"> <time datetime="2016-01-20T22:59:59.000Z" itemprop="datePublished">2016-01-20</time>
<time class="hide" datetime="2016-01-20T22:59:59.000Z" itemprop="dateModified">2016-01-20</time> </a>
<span class="hide" itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"> <a class="breadcrumb" href="https://plus.google.com/102455247906663845886" itemprop="url" rel="author">victor felder</a> </span> </span> <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization"> <meta itemprop="name" content="concise notes"> </div> </div> </div> </nav> <div class="article-inner"> <header class="article-header"> <h1 class="article-title" itemprop="headline"> Modifying or Deleting a Line from an Old Commit </h1> </header> <div class="article-entry" itemprop="articleBody"> <p>I’ll spare you and assume you know what you’re doing, so here’s the short version. Keep reading for a more comprehensive one.</p> <ol> <li>Find the commit you want to change or delete</li> <li>Get the SHA of its child commit.</li> <li><code>git rebase -i 1a2b3c4d</code> (1a2b3c4d is the child)</li> <li>Replace <code>pick</code> with <code>edit</code></li> <li><code>git add yourfile</code></li> <li><code>git commit --amend</code></li> <li><code>git rebase --continue</code></li> </ol> <p>I work alone on most of my side projects. They are experiments, personal documentations, <del>stupid</del> ideas… they have something in common though, they are versioned using git and I’m often their only contributor. Which means that if I want to rewrite the history and <code>git push --force</code>, I can! It won’t break someone else’s work!</p> <p>Maybe I shouldn’t have stricken out <em>stupid</em> here. Two months ago I had an idea. It came out of nowhere and was very easy to do, so I did it. <em>Let’s log the content of my clipboard every minute!</em></p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * <span class="built_in">cd</span> ~/repositories/clipboard/ &amp;&amp; pbpaste &gt; clipboard.txt &amp;&amp; git aa &amp;&amp; git commit -m <span class="string">"`date`"</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &gt;/dev/null</span><br></pre></td></tr></table></figure> <p>This idea being stupid and/or useless does not mean I <em>am</em> stupid or useless, I was obviously not going to push this to a remote server.</p> <p>But let’s pretend I’d like to anyway. We can very safely assume that doing so would be very unsafe: there are probably a bunch of my passwords in the repo (copy-pasted from my password manager), and private emails (written in my text editor and copy-pasted to my webmail), and kilobytes of source code I wrote at work, etc.</p> <p>Obviously, trying to delete all potential private data from my clipboard repo would be a hard and painful process of carefully reviewing the content of each of the thousands of commits it contains.</p> <p>So for the sake of the demonstration, and because I used this post as an excuse to tell you about the futility of logging your clipboard, or because I used the futility of logging my clipboard to blog about how to change / delete an old commit, here’s how you could achieve the removal of <code>mysecret</code> from your git repo without leaving any trace (given that nobody cloned or forked your repo):</p> <ol> <li>Find the commit you want to change or delete:<ul> <li>If you already know the commit SHA, easy.</li> <li>If you know the commit message, <code>git log --grep=&#39;Versioning my secret&#39; # --all for all branches</code></li> <li>If you know the commit content, <code>git grep mysecret $(git rev-list --all)</code></li> <li>If you know which file contains your secret, <code>git blame file</code>, find line, get SHA, checkout SHA, blame, repeat until you get the first commit introducing the secret (don’t settle for the 20 following commits fiddling with this line’s whitespaces).</li> <li>Choose whatever option gets you the SHA the quickest. The order listed here is not that bad in my opinion. So, your secret first appeared in your git repository at commit <code>054f345865f8f5a319dc05fcfa6cf9b76541e229</code></li> </ul> </li> <li>You actually need the SHA of the child commit. The commit that came directly after the one you want to modify or get rid of.<ul> <li><code>git rev-list --all | grep 054f345865f8f5a319dc05fcfa6cf9b76541e229 -A1 | tail -n1</code></li> <li>So, the child is <code>e20645764ce6419e348e6c1b5dea2348e18d050f</code></li> </ul> </li> <li>We will rebase after the child.<ul> <li><code>git rebase -i e20645764ce6419e348e6c1b5dea2348e18d050f</code></li> </ul> </li> <li>The first line should be the one for your “bad” commit: <code>pick 054f345 versioning secret stuff!</code><ul> <li>Replace <code>pick</code> with <code>edit</code>.</li> <li>Close the editor to start rebasing.</li> </ul> </li> <li>Your repo is now at the bad commit. Edit <code>yourfile</code> and remove your secret from it. Or delete <code>yourfile</code>.</li> <li><code>git add yourfile</code></li> <li><code>git commit --amend</code></li> <li><code>git rebase --continue</code></li> <li>Done!</li> </ol> <p>Note that if you simply want to <em>delete the bad commit</em> instead of <em>editing it to remove a secret from a file or remove a file from the commit</em>, this won’t work. Simply drop the commit when rebasing instead of <code>edit</code>ing it.</p> <p>The first time I had to do that it took me quite some time to figure it out, and search engines weren’t that helpful.</p> <p>If you have a complex history and would like to edit a bad merge or other weird cases AND if you like <em>choose your own adventure</em> books, take a look at this: <a href="http://sethrobertson.github.io/GitFixUm/fixup.html" target="_blank" rel="external">http://sethrobertson.github.io/GitFixUm/fixup.html</a>. It’s as awesome as it’s hard to navigate! :)</p> <p>PS: I’m not responsible if you rewrite the history of a publicly traded github repository.<br>PPS: I’m now the very proud owner of a very useless domain name: <a href="http://☑.ml" target="_blank" rel="external">☑.ml</a>. (You can even append <code>/blog/</code> to get here. UTF-8 works!) Finally a URL I could handwrite without worrying about my handwriting (while worrying about the poor people who will try to type it in their browser instead)!</p> </div> <footer class="article-footer"> <div class="row"> <div class="col s6"> <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/git/">git</a></li></ul> &nbsp; </div> <div class="col s6 right-align"> <div class="article-footer-right"> <a data-url="https://vhf.github.io/blog/2016/01/20/modifying-or-deleting-a-line-from-an-old-commit/" data-id="cijnfoo6d0001snab0xbmod4n" class="article-share-link">share</a> or <a href="https://github.com/vhf/concise-notes/edit/master/source/_posts/2016-01-20-modifying-or-deleting-a-line-from-an-old-commit.md" class="article-suggest-modification">suggest a modification</a> </div> </div> </div> </footer> </div> <div class="row"> <div class="col s12"> <div class="post-nav"> <div class="post-nav-title blue-grey darken-1 left center-align"> <span class="white-text">Older</span> </div> <div class="post-nav-content clear"> <a href="/blog/2016/01/15/one-simple-trick-for-javascript-performance-optimization/"> One Simple Trick for JavaScript Performance Optimization </a> </div> </div> </div> </div> </article> </main> </div> <footer class="page-footer blue-grey darken-3"> <div class="row"> <div class="col l3 s12"> <h5 class="white-text">Categories</h5> <p class="grey-text text-lighten-4"> <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/programming/">programming</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/programming/JavaScript/">JavaScript</a><span class="category-list-count">5</span></li></ul></li></ul> </p> </div> <div class="col l3 s12"> <h5 class="white-text">Tags</h5> <p class="grey-text text-lighten-4"> <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/babel/">babel</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/crankshaft/">crankshaft</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/es2015/">es2015</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/javascript/">javascript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/nodejs/">nodejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/programming-language-design/">programming language design</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/promises/">promises</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/v8/">v8</a><span class="tag-list-count">1</span></li></ul> </p> </div> <div class="col l3 s12"> <h5 class="white-text">Archives</h5> <p class="grey-text text-lighten-4"> <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/01/">January 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li></ul> </p> </div> <div class="col l3 s12"> <h5 class="white-text">Recent posts</h5> <p class="grey-text text-lighten-4"> <ul> <li> <a href="/blog/2016/01/20/modifying-or-deleting-a-line-from-an-old-commit/">Modifying or Deleting a Line from an Old Commit</a> </li> <li> <a href="/blog/2016/01/15/one-simple-trick-for-javascript-performance-optimization/">One Simple Trick for JavaScript Performance Optimization</a> </li> <li> <a href="/blog/2016/01/13/comment-syntax-in-programming-languages/">Comment Syntax in Programming Languages (and the Eye of Osiris)</a> </li> <li> <a href="/blog/2015/12/17/making-babel-fast-with-rest-parameters/">Making Babel fast with ES2015 rest parameters</a> </li> <li> <a href="/blog/2015/11/02/javascript-performance-with-babel-and-node-js/">JavaScript performance with Babel and Node.js: a case against default parameters in tail call optimizations</a> </li> </ul> </p> </div> </div> <div class="footer-copyright blue-grey darken-3"> &copy; 2016 victor felder<br> </div> </footer> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script src="/blog/js/script.js" type="text/javascript"></script></div></body>